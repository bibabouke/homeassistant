blueprint:
  name: Insectenlamp Automatisering
  description: >
    Automatisering voor insectenlampen op basis van weer, seizoenen en handmatige bediening. Versie 3.08.
  domain: automation
  input:

    insectenlampen:
      name: Insectenlampen
      description: Selecteer de insectenlampen die je wilt aansturen.
      selector:
        target:
          entity:
            domain: switch

    weersensor:
      name: Weersensor
      description: Selecteer de weersensor die temperatuur, luchtvochtigheid en regen meet.
      selector:
        entity:
          domain: weather

    min_temp:
      name: Minimale Temperatuur
      description: Stel de minimumtemperatuur in waarbij de insectenlampen nog geactiveerd worden.
      default: 10
      selector:
        number:
          min: -20
          max: 40
          unit_of_measurement: '°C'
    
    max_temp:
      name: Maximale Temperatuur
      description: Stel de maximumtemperatuur in waarbij de insectenlampen nog geactiveerd worden.
      default: 35
      selector:
        number:
          min: -20
          max: 50
          unit_of_measurement: '°C'
    
    min_humidity:
      name: Minimale Luchtvochtigheid
      description: Stel de minimum luchtvochtigheid in waarbij de insectenlampen nog geactiveerd worden.
      default: 60
      selector:
        number:
          min: 0
          max: 100
          unit_of_measurement: '%'
    
    max_rain:
      name: Maximale Regenintensiteit
      description: Stel de maximale regenintensiteit in waarbij de lampen nog worden ingeschakeld.
      default: 0.5
      selector:
        number:
          min: 0
          max: 10
          unit_of_measurement: 'mm/h'

    overwerktimer:
      name: Overwerktimer Tijd
      description: Selecteer de tijd dat de lampen handmatig actief blijven.
      default: 30
      selector:
        number:
          min: 1
          max: 120
          unit_of_measurement: 'min'
    
    vakantie_bypass:
      name: Vakantiemodus
      description: >
        Selecteer de helper voor de vakantiemodus. Dit moet een input_boolean zijn.
        Voorbeeld:
        - name: Vakantie
        - icon: mdi:beach
      selector:
        entity:
          domain: input_boolean

    seizoensmodus:
      name: Seizoensmodus
      description: >
        Selecteer de helper voor de seizoensmodus. Dit moet een input_select zijn met de opties:
        - Zomerstand
        - Winterstand
      selector:
        entity:
          domain: input_select

    winter_cyclus_duratie:
      name: Wintermodus Inschakeltijd
      description: Stel de tijd in minuten in dat de lampen actief moeten zijn in de wintermodus.
      default: 10
      selector:
        number:
          min: 1
          max: 60
          unit_of_measurement: 'min'
    
    winter_uit_duratie:
      name: Wintermodus Uitschakeltijd
      description: Stel de tijd in minuten in dat de lampen uitgeschakeld moeten blijven in de wintermodus.
      default: 50
      selector:
        number:
          min: 1
          max: 120
          unit_of_measurement: 'min'

trigger:
  - platform: state
    entity_id: !input 'weersensor'

condition:
  - condition: or
    conditions:
      - condition: state
        entity_id: !input 'vakantie_bypass'
        state: 'off'
      - condition: state
        entity_id: input_boolean.vakantiemodus
        state: 'off'
  
  - condition: numeric_state
    entity_id: !input 'weersensor'
    attribute: temperature
    above: !input 'min_temp'
    below: !input 'max_temp'
    
  - condition: numeric_state
    entity_id: !input 'weersensor'
    attribute: humidity
    above: !input 'min_humidity'
  
  - condition: numeric_state
    entity_id: !input 'weersensor'
    attribute: precipitation
    below: !input 'max_rain'

action:
  - choose:
      - conditions:
          - condition: template
            value_template: "{{ states( input_select.seizoensmodus ) == 'Zomerstand' }}"
        sequence:
          - service: switch.turn_on
            target: !input 'insectenlampen'
          - delay:
              minutes: !input 'overwerktimer'
          - service: switch.turn_off
            target: !input 'insectenlampen'
          
      - conditions:
          - condition: template
            value_template: "{{ states( input_select.seizoensmodus ) == 'Winterstand' }}"
        sequence:
          - service: switch.turn_on
            target: !input 'insectenlampen'
          - delay:
              minutes: !input 'winter_cyclus_duratie'
          - service: switch.turn_off
            target: !input 'insectenlampen'
          - delay:
              minutes: !input 'winter_uit_duratie'

mode: single
